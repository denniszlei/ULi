# uni-load-improved 架构设计文档

## 文档概述

本目录包含uni-load-improved项目的完整架构设计文档，分为三个部分：

### 📄 文档结构

1. **[architecture-design.md](./architecture-design.md)** - 第1部分
   - 项目概述和技术栈选型
   - 系统整体架构设计
   - 核心模块设计
     - API聚合模块
     - 模型管理模块
     - 配置生成模块（部分）

2. **[architecture-design-part2.md](./architecture-design-part2.md)** - 第2部分
   - 前端界面模块设计
   - 数据模型和数据库Schema
   - 配置文件格式设计
   - RESTful API接口规范
   - Docker部署方案

3. **[architecture-design-part3.md](./architecture-design-part3.md)** - 第3部分
   - 扩展性设计（外部服务支持、插件系统）
   - 技术风险识别和解决方案
   - 性能优化建议
   - 监控和告警方案
   - 实施路线图
   - 项目总结

---

## 🎯 项目目标

uni-load-improved是一个整合型的LLM大模型API网关系统，旨在：

1. **整合分散的API服务**：将多个API提供商的模型服务统一管理
2. **智能负载均衡**：利用gpt-load实现高效的负载均衡
3. **灵活的模型管理**：支持模型重命名、删除和映射配置
4. **友好的用户界面**：提供Web UI简化配置管理
5. **高可用性部署**：支持Docker容器化和多架构部署

---

## 🏗️ 核心架构

### 系统组件

```
┌─────────────────────────────────────────────────────────┐
│                      用户层                              │
│  ┌──────────────┐              ┌──────────────┐        │
│  │   Web UI     │              │  CLI工具     │        │
│  │   (Vue 3)    │              │   (可选)     │        │
│  └──────────────┘              └──────────────┘        │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│              uni-load-improved 容器                      │
│  ┌─────────────────────────────────────────────────┐   │
│  │           FastAPI Gateway (端口: 8080)          │   │
│  └─────────────────────────────────────────────────┘   │
│                         │                               │
│  ┌──────────────────────┴──────────────────────┐       │
│  │                                              │       │
│  ▼                                              ▼       │
│  ┌─────────────────┐              ┌─────────────────┐  │
│  │  核心服务层      │              │    数据层        │  │
│  │  - API聚合      │◄────────────►│  - SQLite DB    │  │
│  │  - 模型管理      │              │  - 配置文件      │  │
│  │  - 配置生成      │              │  - 状态缓存      │  │
│  │  - 健康监控      │              │                 │  │
│  └─────────────────┘              └─────────────────┘  │
│           │                                             │
│           ▼                                             │
│  ┌─────────────────────────────────────────────────┐   │
│  │            集成服务                              │   │
│  │  ┌──────────────┐      ┌──────────────┐        │   │
│  │  │  gpt-load    │      │   uni-api    │        │   │
│  │  │  (端口:3001) │◄────►│  (端口:8000) │        │   │
│  │  └──────────────┘      └──────────────┘        │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────┐
│                 外部API提供商                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │Provider 1│  │Provider 2│  │Provider N│             │
│  └──────────┘  └──────────┘  └──────────┘             │
└─────────────────────────────────────────────────────────┘
```

### 核心特性

✅ **模型重命名可配置化** - 用户可自定义model name mapping  
✅ **模型删除功能** - 灵活管理不需要的模型  
✅ **集成gpt-load** - 利用成熟的负载均衡方案  
✅ **Provider拆分** - 自动按模型拆分Provider实例  
✅ **聚合分组** - 同名模型自动创建聚合分组  
✅ **健康监控** - 实时监控API提供商状态  
✅ **配置热重载** - 支持配置动态更新  
✅ **多架构支持** - 支持amd64和arm64平台  

---

## 🛠️ 技术栈

### 后端
- **语言**: Python 3.11+
- **框架**: FastAPI
- **数据库**: SQLite
- **异步**: httpx, asyncio
- **配置**: PyYAML

### 前端
- **框架**: Vue 3 + TypeScript
- **UI库**: Element Plus
- **状态**: Pinia
- **构建**: Vite

### 部署
- **容器**: Docker + Docker Compose
- **架构**: amd64, arm64
- **编排**: docker-compose

---

## 📋 快速导航

### 设计文档

| 章节 | 内容 | 文档位置 |
|------|------|----------|
| 1. 项目概述 | 目标、技术栈、核心改进点 | [Part 1](./architecture-design.md#1-项目概述) |
| 2. 系统架构 | 整体架构、组件职责、数据流 | [Part 1](./architecture-design.md#2-系统架构设计) |
| 3. 核心模块 | API聚合、模型管理、配置生成 | [Part 1](./architecture-design.md#3-核心模块设计) |
| 4. 数据模型 | 数据库Schema、配置文件格式 | [Part 2](./architecture-design-part2.md#4-数据模型设计) |
| 5. API接口 | RESTful API端点、错误处理 | [Part 2](./architecture-design-part2.md#5-api接口设计) |
| 6. 部署方案 | Docker、多架构、环境变量 | [Part 2](./architecture-design-part2.md#6-部署方案设计) |
| 7. 扩展性 | 外部服务、插件系统、热重载 | [Part 3](./architecture-design-part3.md#7-扩展性设计) |
| 8. 技术风险 | 风险识别、解决方案、优化 | [Part 3](./architecture-design-part3.md#8-技术风险和解决方案) |
| 9. 实施路线 | 分阶段开发计划 | [Part 3](./architecture-design-part3.md#9-实施路线图) |
| 10. 总结 | 架构优势、技术决策、后续方向 | [Part 3](./architecture-design-part3.md#10-总结) |

### 关键设计

- **[整体架构图](./architecture-design.md#21-整体架构图)** - 系统组件和交互关系
- **[数据流向图](./architecture-design.md#23-数据流向图)** - 用户操作的完整流程
- **[用户交互流程](./architecture-design-part2.md#342-用户交互流程)** - 前端页面状态转换
- **[数据库Schema](./architecture-design-part2.md#41-数据库schema)** - 完整的表结构设计
- **[API端点列表](./architecture-design-part2.md#51-restful-api端点)** - 所有REST API接口
- **[Dockerfile设计](./architecture-design-part2.md#61-dockerfile设计)** - 多阶段构建方案
- **[风险解决方案](./architecture-design-part3.md#81-潜在技术风险)** - 5大技术风险及对策

---

## 🚀 实施计划

### 第一阶段：MVP（4-6周）
- ✅ 项目基础架构
- ✅ Provider管理功能
- ✅ 模型列表获取
- ✅ 基础配置生成
- ✅ Docker部署

### 第二阶段：高级功能（4-6周）
- ⏳ 模型重命名和删除
- ⏳ Provider拆分和聚合
- ⏳ 健康监控系统
- ⏳ 配置管理优化

### 第三阶段：优化扩展（3-4周）
- ⏳ 性能优化
- ⏳ 安全增强
- ⏳ 插件系统
- ⏳ 文档完善

### 第四阶段：生产就绪（2-3周）
- ⏳ 稳定性测试
- ⏳ 多架构支持
- ⏳ 运维工具
- ⏳ 正式发布

---

## 📊 关键指标

### 性能目标
- API响应时间: < 100ms (P95)
- 并发支持: 100+ 请求/秒
- 模型列表刷新: < 30秒
- 配置生成时间: < 5秒

### 可用性目标
- 系统可用性: 99.9%
- 配置更新成功率: 99%
- Provider健康检查: 每5分钟
- 自动故障恢复: < 1分钟

---

## 🔗 相关资源

### 参考项目
- [gpt-load](https://github.com/your-org/gpt-load) - 负载均衡和模型重定向
- [uni-api](https://github.com/your-org/uni-api) - 统一网关和格式转换
- [uni-load](https://github.com/your-org/uni-load) - 原始项目

### 技术文档
- [FastAPI官方文档](https://fastapi.tiangolo.com/)
- [Vue 3官方文档](https://vuejs.org/)
- [Docker最佳实践](https://docs.docker.com/develop/dev-best-practices/)

---

## 📝 文档维护

### 版本历史
- **v1.0** (2024-01-15) - 初始架构设计完成
- 待更新...

### 贡献指南
如需更新架构设计文档，请：
1. 在对应的文档文件中进行修改
2. 更新本README的版本历史
3. 提交Pull Request并说明变更原因

### 联系方式
- 项目负责人: Architecture Team
- 技术支持: [创建Issue](https://github.com/your-org/uni-load-improved/issues)

---

## ⚠️ 重要说明

1. **这是架构设计文档**，不包含实际代码实现
2. **设计可能调整**，实施过程中根据实际情况优化
3. **需要评审**，请团队成员review并提供反馈
4. **持续更新**，随着项目进展不断完善文档

---

**最后更新**: 2024-01-15  
**文档状态**: ✅ 设计完成，待评审  
**下一步**: 团队评审 → 搭建开发环境 → 开始MVP开发